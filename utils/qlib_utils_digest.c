/************************************************************************************************************
* @internal
* @remark     Winbond Electronics Corporation - Confidential
* @copyright  Copyright (c) 2021 by Winbond Electronics Corporation . All rights reserved
* @endinternal
*
* @file       qlib_utils_digest.c
* @brief      This file contains digest utility functions
*
* ### project qlib
*
************************************************************************************************************/

/*---------------------------------------------------------------------------------------------------------*/
/*---------------------------------------------------------------------------------------------------------*/
/*                                                INCLUDES                                                 */
/*---------------------------------------------------------------------------------------------------------*/
/*---------------------------------------------------------------------------------------------------------*/
#include "qlib_utils_digest.h"

/*---------------------------------------------------------------------------------------------------------*/
/*---------------------------------------------------------------------------------------------------------*/
/*                                           INTERFACE FUNCTIONS                                           */
/*---------------------------------------------------------------------------------------------------------*/
/*---------------------------------------------------------------------------------------------------------*/

QLIB_STATUS_T QLIB_UTILS_CalcDigest(U32* buf, U32 size, U64* digest)
{
    _256BIT hash_result;

    /*-----------------------------------------------------------------------------------------------------*/
    /* Error checking                                                                                      */
    /*-----------------------------------------------------------------------------------------------------*/
    if (NULL == digest)
    {
        return QLIB_STATUS__INVALID_PARAMETER;
    }

    if (NULL == buf || 0 == size)
    {
        ((U32*)digest)[0] = 0;
        ((U32*)digest)[1] = 0;
        return QLIB_STATUS__INVALID_PARAMETER;
    }

    /*-----------------------------------------------------------------------------------------------------*/
    /* Calculate digest                                                                                    */
    /*-----------------------------------------------------------------------------------------------------*/
    PLAT_HASH(hash_result, buf, size);

    /*-----------------------------------------------------------------------------------------------------*/
    /* Set output                                                                                          */
    /*-----------------------------------------------------------------------------------------------------*/
    ((U32*)digest)[0] = hash_result[6];
    ((U32*)digest)[1] = hash_result[7];

    return QLIB_STATUS__OK;
}
